<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Counter dApp</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; background: #fff; }
    button { margin: 5px; padding: 10px 15px; cursor: pointer; }
    #log { background-color:#0d1117; color:#00ffcc; padding:10px; border-radius:8px; width:70%; margin:20px auto; text-align:left; }
  </style>
</head>
<body>
  <h2>Counter dApp</h2>

  <button id="btnConnect">MetaMask'e Bağlan</button>
  <button id="btnGet">Değeri Oku</button>
  <button id="btnInc">Artır</button>
  <button id="btnDec">Azalt</button>

  <p>Kontrat adresi: <span id="caddr"></span></p>
  <p>Değer: <span id="value">-</span></p>

  <div id="log">Günlük:</div>

  <script>
    const CONTRACT_ADDRESS = "0x0f40F94D2C8a16fA78004E8928F1cb449B18A4d5";
    const ABI = [
      { "inputs": [], "name": "decrement", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
      { "inputs": [], "name": "increment", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
      { "inputs": [], "name": "get", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }
    ];

    let provider, signer, contract;

    async function connect() {
      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        const account = await signer.getAddress();
        $("#log").append(`<p>Bağlandı: ${account}</p>`);
      } catch (err) {
        $("#log").append(`<p style='color:red'>Bağlantı hatası: ${err.message}</p>`);
      }
    }

    async function getVal() {
      try {
        const val = await contract.get();
        $("#value").text(val.toString());
      } catch (err) {
        $("#log").append(`<p style='color:red'>Okuma hatası: ${err.message}</p>`);
      }
    }

    async function inc() {
      try {
        const tx = await contract.increment();
        await tx.wait();
        $("#log").append(`<p>Artırma onaylandı ✅</p>`);
        $("#log").append(`<p><a href='https://sepolia.etherscan.io/tx/${tx.hash}' target='_blank'>${tx.hash}</a></p>`);
        await getVal();
      } catch (err) {
        $("#log").append(`<p style='color:red'>Artırma hatası: ${err.message}</p>`);
      }
    }

    async function dec() {
      try {
        const tx = await contract.decrement();
        await tx.wait();
        $("#log").append(`<p>Azaltma onaylandı ✅</p>`);
        $("#log").append(`<p><a href='https://sepolia.etherscan.io/tx/${tx.hash}' target='_blank'>${tx.hash}</a></p>`);
        await getVal();
      } catch (err) {
        $("#log").append(`<p style='color:red'>Azaltma hatası: ${err.message}</p>`);
      }
    }

    $("#btnConnect").on("click", connect);
    $("#btnGet").on("click", getVal);
    $("#btnInc").on("click", inc);
    $("#btnDec").on("click", dec);

    $("#caddr").text(CONTRACT_ADDRESS);
  </script>
</body>
</html>
